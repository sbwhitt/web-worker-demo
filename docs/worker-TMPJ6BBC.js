var g=class{alpha;gamma;rar;radr;s;a;Q;constructor(e,u=1,r=.9,m=.5,o=.9){if(e.numStates===void 0&&e.numActions===void 0&&e.Q!==void 0)this.Q=e.Q;else if(e.numStates!==void 0&&e.numActions!==void 0)this.Q=this.buildQ(e.numStates,e.numActions);else throw Error("QLearner initialized with invalid options.");this.alpha=u,this.gamma=r,this.rar=m,this.radr=o}setState=e=>(this.s=e,this.a=this.selectAction(e,!1),this.a);query=(e,u,r)=>(this.updateQ(this.s,this.a,e,u),this.s=e,this.a=this.selectAction(e,r),this.rar=this.rar*this.radr,this.a);buildQ=(e,u)=>{let r=[];for(;r.length<e;)r.push(new Array(u).fill(0));return r};selectAction=(e,u)=>{let r=this.Q[e],m=Math.random();if(u&&m<=this.rar)return Math.floor(Math.random()*r.length);let o=0,b=r[o];for(let h=1;h<r.length;h++)r[h]>b&&(o=h,b=r[h]);return o};updateQ=(e,u,r,m)=>{let o=this.Q[e][u],b=this.Q[r][this.selectAction(r,!1)];this.Q[e][u]=o+this.alpha*(m+this.gamma*b-o)}};function w(d){let e=Math.pow(3,9),u=9,r=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]],m=new g({numStates:e,numActions:u}),o=t=>{for(let n=0;n<t;n++){let a=0,s=0,c="000000000",l=h(c),f=m.setState(l),p="active";for(;p==="active"&&a<1e3;){c=L(l,f,!0),l=h(c),p=S(l);let v=A(p);f=m.query(l,v,!0),s+=v,a+=1}postMessage(n+1)}},b=t=>t.toString(3).padStart(9,"0"),h=t=>Number.parseInt(t,3),S=t=>{let i=b(t);for(let n of r){let a=i[n[0]]+i[n[1]]+i[n[2]];if(a==="111")return"win";if(a==="222")return"lose"}for(let n of r){let a=i[n[0]]+i[n[1]]+i[n[2]];if(!(a.includes("1")&&a.includes("2")))return"active"}return"draw"},A=t=>{switch(t){case"win":return 3;case"lose":return-5;case"draw":return-1;case"active":return-2;default:return-1}},Q=(t,i,n)=>{let a=[...t];return a[i]=n.toString(),a.join("")},M=t=>{let i=[];if([...t].map((s,c)=>{s==="0"&&i.push(c)}),i.length===0)return t;let n=null,a=Math.random();for(let s of r){if(a<.5)break;let c=s[0],l=s[1],f=s[2];if(t[c]===t[l]&&t[f]==="0"){n=f;break}else if(t[c]===t[f]&&t[l]==="0"){n=l;break}else if(t[l]===t[f]&&t[c]==="0"){n=c;break}}return n=n||i[Math.floor(Math.random()*i.length)],Q(t,n,2)},L=(t,i,n=!1,a=1)=>{let s=b(t);return s[i]!=="0"?s:(s=Q(s,i,a),n?M(s):s)};return o(d),m.Q}addEventListener("message",({data:d})=>{let e=w(d);postMessage(e)});
